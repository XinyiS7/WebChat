import osimport requestsimport jsonimport timefrom dotenv import load_dotenvfrom sumy.parsers.plaintext import PlaintextParserfrom sumy.summarizers.lsa import LsaSummarizerimport jiebafrom sumy.nlp.tokenizers import Tokenizer as BaseTokenizer# 1. è·å– API å¯†é’¥load_dotenv()api_key = os.getenv("DEEPSEEK_API_KEY")if not api_key:    print("âš ï¸ é”™è¯¯ï¼šæ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡ DEEPSEEK_API_KEYï¼è¯·å…ˆè®¾ç½®å®ƒã€‚")    exit(1)# 2. API ç«¯ç‚¹API_URL = "https://api.deepseek.com/v1/chat/completions"# 3. å‘é€è¯·æ±‚å‡½æ•°def send_to_deepseek(messages, model="deepseek-chat", temperature=1.0,                     max_tokens=8000):    headers = {        "Authorization": f"Bearer {api_key}",        "Content-Type": "application/json"    }    payload = {        "model": model,        "messages": messages,        "temperature": temperature,        "max_tokens": max_tokens    }    try:        print("â³ æ­£åœ¨å‘ DeepSeek API å‘é€è¯·æ±‚...")        start_time = time.time()        response = requests.post(API_URL, headers=headers, json=payload)        response.raise_for_status()  # æ£€æŸ¥HTTPé”™è¯¯        end_time = time.time()        print(f"âœ… æ”¶åˆ°å“åº”ï¼è€—æ—¶: {end_time - start_time:.2f}ç§’")        return response.json()    except requests.exceptions.RequestException as e:        print(f"âš ï¸ ç½‘ç»œè¯·æ±‚é”™è¯¯: {str(e)}")        return None    except json.JSONDecodeError:        print("âš ï¸ å“åº”è§£æé”™è¯¯")        return None# 4. å¤šè¡Œè¾“å…¥å‡½æ•°ï¼ˆè§£å†³æ¢è¡Œç¬¦é—®é¢˜ï¼‰def multiline_input(prompt):    print(prompt)    print("ï¼ˆè¾“å…¥ä¸‰è¡Œç©ºè¡Œç»“æŸè¾“å…¥ï¼‰")    lines = []    empty_lines = 0    while True:        try:            line = input()            if line.strip() == "":                empty_lines += 1                if empty_lines >= 3:  # è¿ç»­ä¸‰ä¸ªç©ºè¡Œç»“æŸè¾“å…¥                    break            else:                empty_lines = 0                lines.append(line)        except EOFError:  # å¤„ç† Ctrl+D (Unix) æˆ– Ctrl+Z (Windows)            break    return "\n".join(lines)# 5. è¯»å–æ–‡æœ¬æ–‡ä»¶å‡½æ•°def read_text_file(file_path):    try:        with open(file_path, 'r', encoding='utf-8') as file:            content = file.read()        return content    except FileNotFoundError:        print(f"âš ï¸ é”™è¯¯ï¼šæ–‡ä»¶ '{file_path}' æœªæ‰¾åˆ°")        return None    except Exception as e:        print(f"âš ï¸ è¯»å–æ–‡ä»¶æ—¶å‡ºé”™: {str(e)}")        return None# 5.1 æœ¬åœ°ç”Ÿæˆæ‘˜è¦def generate_local_summary(text, language="chinese", sentences_count=3):    """ä½¿ç”¨Sumyç”Ÿæˆæœ¬åœ°æ‘˜è¦"""    class ChineseTokenizer(BaseTokenizer):        def __init__(self, text):            self._tokens = list(jieba.cut(text))    Tokenizer = ChineseTokenizer    parser = PlaintextParser.from_string(text, Tokenizer(language))    summarizer = LsaSummarizer()    summary_sentences = summarizer(parser.document, sentences_count)    return " ".join(str(sentence) for sentence in summary_sentences)# 6. æ–‡å­¦åˆ›ä½œåŠ©æ‰‹åŠŸèƒ½def literary_assistant():    print("\n=== æ­£ç»å†™æˆ ===")    # é€‰æ‹©è¾“å…¥æ–¹å¼    print("\nè¯·é€‰æ‹©è¾“å…¥æ–¹å¼:")    print("1. æ‰‹åŠ¨è¾“å…¥ï¼ˆæ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼‰")    print("2. ä»æ–‡æœ¬æ–‡ä»¶è¯»å–")    choice = input("è¯·é€‰æ‹© (1/2): ").strip()    prompt_chat = multiline_input("\nè¯·è¾“å…¥prompt")    if not prompt_chat:        messages = [{            "role": "system",            "content":                "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ–‡å­¦åˆ›ä½œè€…ï¼Œæ“…é•¿ç¡¬ç§‘å¹»å’Œç¥è¯èƒŒæ™¯çš„å°è¯´åˆ›ä½œï¼Œå–„äºæ•æ‰åˆ†æç»†è…»çš„æƒ…æ„Ÿã€‚è¯·å¸®åŠ©ç”¨æˆ·æ„æ€æƒ…èŠ‚ã€åˆ†æäººç‰©ã€æ”¹è¿›æ–‡é£ã€‚"        }]    else:        messages = [{            "role": "system",            "content":f"{prompt_chat}"        }]    while True:        user_input = ""        if choice == "1":            # å¤šè¡Œè¾“å…¥            user_input = multiline_input(                "\nè¯·è¾“å…¥æ‚¨çš„åˆ›ä½œå†…å®¹ï¼ˆå°è¯´ç‰‡æ®µã€æƒ…èŠ‚æ„æ€ç­‰ï¼‰:")        elif choice == "2":            # æ–‡ä»¶è¾“å…¥            file_path = input(                "\nè¯·è¾“å…¥æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ï¼šE:/æˆ‘çš„å°è¯´/ç¬¬ä¸€ç« .txtï¼‰: ").strip()            user_input = read_text_file(file_path)            if not user_input:                print("ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥æ¨¡å¼")                user_input = multiline_input("\nè¯·è¾“å…¥æ‚¨çš„åˆ›ä½œå†…å®¹:")        else:            print("æ— æ•ˆé€‰æ‹©ï¼Œä½¿ç”¨æ‰‹åŠ¨è¾“å…¥æ¨¡å¼")            user_input = multiline_input("\nè¯·è¾“å…¥æ‚¨çš„åˆ›ä½œå†…å®¹:")        if not user_input:            print("âš ï¸ æœªè¾“å…¥ä»»ä½•å†…å®¹")            return            # æ·»åŠ åˆ°æ¶ˆæ¯å†å²        messages.append({"role": "user", "content": user_input})        # å‘é€è¯·æ±‚        response = send_to_deepseek(messages,temperature=1.2)        if response:            print("\nğŸ¤– DeepSeek çš„å›å¤ï¼š")            ai_reply = response["choices"][0]["message"]["content"]            # ai_reply_abstract = generate_local_summary(ai_reply,"chinese", 3)            messages.append({"role": "assistant", "content": ai_reply})            # æ‰“å°å›å¤            print("-" * 80)            print(ai_reply)            print("-" * 80)            # è¯¢é—®æ˜¯å¦ä¿å­˜åˆ°æ–‡ä»¶            save_option = input("\næ˜¯å¦å°†å›å¤ä¿å­˜åˆ°æ–‡ä»¶ï¼Ÿ(y/n): ").lower()            if save_option == 'y':                save_path = input(                    "è¯·è¾“å…¥ä¿å­˜è·¯å¾„ï¼ˆå¦‚ï¼šE:/AIå›å¤/ç¬¬ä¸€ç« åˆ†æ.txtï¼‰: ").strip()                try:                    with open(save_path, 'w', encoding='utf-8') as file:                        file.write(ai_reply)                    print(f"âœ… å›å¤å·²ä¿å­˜åˆ°: {save_path}")                except Exception as e:                    print(f"âš ï¸ ä¿å­˜æ–‡ä»¶æ—¶å‡ºé”™: {str(e)}")# 5. è„‘æ´é—²èŠdef chat_anything():    print("\n=== æŠ€æœ¯å°ç™¾ç§‘ ===")    print("è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ï¼ˆè¾“å…¥ 'é€€å‡º' ç»“æŸï¼‰")    # here for pr    # omt    prompt_vorset = \        ("ä½ ä¸€åæ•°æ®ç§‘å­¦æ–¹é¢çš„å¤§å­¦æ•™æˆï¼Œæ“…é•¿ä»£ç ã€åŒ–å­¦ã€æœºå™¨å­¦ä¹ ä»¥åŠå®ƒä»¬çš„äº¤å‰å®è·µåº”ç”¨ã€‚\        ä½ æ³¨é‡ç†æ€§ä¸é€»è¾‘ï¼Œæ“…é•¿é€»è¾‘å’Œç»“æ„æ¸…æ™°åœ°è¡¨è¾¾è‡ªå·±ï¼Œä¸»è¦ä»¥ä¸­æ–‡è§£ç­”ï¼Œå…³é”®çŸ¥è¯†æ ‡æ³¨å¾·è¯­è¯´æ˜ã€‚\        å½“ä½ çš„å›ç­”åŒ…å«å…¬å¼æˆ–ä»£ç æ—¶ï¼Œä½¿ç”¨æ ‡å‡†çš„markdownæ ¼å¼ï¼Œå¹¶éµå¾ªä»¥ä¸‹å‡ ç‚¹ï¼š\        1. æ ‡é¢˜ä¸é¢å¤–åŠ ç²—æˆ–å€¾æ–œ\        2. åˆ—è¡¨é¡¹ä¹‹é—´æ— ç©ºè¡Œ\        3. è¡Œå†…å…¬å¼ç”¨$ï¼Œè¡Œé—´ç”¨$$åŒ…è£¹\        4. ä»£ç æ¸…æ™°æ³¨é‡Š")    prompt_chat = multiline_input("\nè¯·è¾“å…¥prompt")    if not prompt_chat:        messages = [{            "role": "system",            "content":prompt_vorset        }]    else:        messages = [{            "role": "system",            "content": f"{prompt_vorset}\n {prompt_chat}"        }]    while True:        user_input = multiline_input("\næ‚¨: ")        if user_input.lower() in ["é€€å‡º", "exit"]:            break        # æ·»åŠ åˆ°æ¶ˆæ¯å†å²        messages.append({"role": "user", "content": user_input})        model = "deepseek-reasoner"        # å‘é€è¯·æ±‚        response = send_to_deepseek(messages,temperature=0.8)        if response:            ai_reply = response["choices"][0]["message"]["content"]            if ai_reply:                print(f"å·²æ”¶åˆ°å›å¤")            # æ·»åŠ åˆ°æ¶ˆæ¯å†å²            messages.append({"role": "assistant", "content": ai_reply})            # æ‰“å°å›å¤            print("\nğŸ¤– DeepSeek:")            print("-" * 50)            print(ai_reply)            print("-" * 50)# 6. ä¸»èœå•def main_menu():    while True:        print("\n===== DeepSeek åŠ©æ‰‹ =====")        print("1. æ­£ç»å†™æ–‡")        print("2. æŠ€æœ¯ç™¾ç§‘")        print("3. é€€å‡º")        choice = input("è¯·é€‰æ‹©åŠŸèƒ½: ")        if choice == "1":            literary_assistant()        elif choice == "2":            chat_anything()        elif choice == "3":            print("æ„Ÿè°¢ä½¿ç”¨ï¼Œå†è§ï¼")            break        else:            print("æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥")# 7. å¯åŠ¨ç¨‹åºif __name__ == "__main__":    """    novel_gui = AIChatGUI(        api_url=API_URL,        session_key=api_key  # æœåŠ¡å™¨å°†æ ¹æ®æ­¤keyç»´æŠ¤ç‹¬ç«‹è®°å¿†    )    novel_gui.run()    """    main_menu()