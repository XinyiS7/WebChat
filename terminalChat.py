import osimport requestsimport jsonimport timefrom dotenv import load_dotenv# 1. è·å– API å¯†é’¥load_dotenv()api_key = os.getenv("DEEPSEEK_API_KEY")if not api_key:    print("âš ï¸ é”™è¯¯ï¼šæ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡ DEEPSEEK_API_KEYï¼è¯·å…ˆè®¾ç½®å®ƒã€‚")    exit(1)# 2. API ç«¯ç‚¹API_URL = "https://api.deepseek.com/chat/completions"# 3. å‘é€è¯·æ±‚å‡½æ•°def send_to_deepseek(messages, model="deepseek-chat", temperature=1.1,                     max_tokens=2000):    headers = {        "Authorization": f"Bearer {api_key}",        "Content-Type": "application/json"    }    payload = {        "model": model,        "messages": messages,        "temperature": temperature,        "max_tokens": max_tokens    }    try:        print("â³ æ­£åœ¨å‘ DeepSeek API å‘é€è¯·æ±‚...")        start_time = time.time()        response = requests.post(API_URL, headers=headers, json=payload)        response.raise_for_status()  # æ£€æŸ¥HTTPé”™è¯¯        end_time = time.time()        print(f"âœ… æ”¶åˆ°å“åº”ï¼è€—æ—¶: {end_time - start_time:.2f}ç§’")        return response.json()    except requests.exceptions.RequestException as e:        print(f"âš ï¸ ç½‘ç»œè¯·æ±‚é”™è¯¯: {str(e)}")        return None    except json.JSONDecodeError:        print("âš ï¸ å“åº”è§£æé”™è¯¯")        return None# 4. å¤šè¡Œè¾“å…¥å‡½æ•°ï¼ˆè§£å†³æ¢è¡Œç¬¦é—®é¢˜ï¼‰def multiline_input(prompt):    print(prompt)    print("ï¼ˆè¾“å…¥ä¸‰è¡Œç©ºè¡Œç»“æŸè¾“å…¥ï¼‰")    lines = []    empty_lines = 0    while True:        try:            line = input()            if line.strip() == "":                empty_lines += 1                if empty_lines >= 3:  # è¿ç»­ä¸‰ä¸ªç©ºè¡Œç»“æŸè¾“å…¥                    break            else:                empty_lines = 0                lines.append(line)        except EOFError:  # å¤„ç† Ctrl+D (Unix) æˆ– Ctrl+Z (Windows)            break    return "\n".join(lines)# 5. è¯»å–æ–‡æœ¬æ–‡ä»¶å‡½æ•°def read_text_file(file_path):    try:        with open(file_path, 'r', encoding='utf-8') as file:            content = file.read()        return content    except FileNotFoundError:        print(f"âš ï¸ é”™è¯¯ï¼šæ–‡ä»¶ '{file_path}' æœªæ‰¾åˆ°")        return None    except Exception as e:        print(f"âš ï¸ è¯»å–æ–‡ä»¶æ—¶å‡ºé”™: {str(e)}")        return None# 6. æ–‡å­¦åˆ›ä½œåŠ©æ‰‹åŠŸèƒ½def literary_assistant():    print("\n=== æ­£ç»å†™æˆ ===")    # é€‰æ‹©è¾“å…¥æ–¹å¼    print("\nè¯·é€‰æ‹©è¾“å…¥æ–¹å¼:")    print("1. æ‰‹åŠ¨è¾“å…¥ï¼ˆæ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼‰")    print("2. ä»æ–‡æœ¬æ–‡ä»¶è¯»å–")    choice = input("è¯·é€‰æ‹© (1/2): ").strip()    # ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ–‡å­¦åˆ›ä½œåŠ©æ‰‹ï¼Œæ“…é•¿ç¡¬ç§‘å¹»å’Œç¥è¯èƒŒæ™¯çš„å°è¯´åˆ›ä½œï¼Œå–„äºæ•æ‰åˆ†æç»†è…»çš„æƒ…æ„Ÿã€‚è¯·å¸®åŠ©ç”¨æˆ·æ„æ€æƒ…èŠ‚ã€åˆ†æäººç‰©ã€æ”¹è¿›æ–‡é£ã€‚    messages = [{        "role": "system",        "content":            ""    }]    while True:        user_input = ""        if choice == "1":            # å¤šè¡Œè¾“å…¥            user_input = multiline_input(                "\nè¯·è¾“å…¥æ‚¨çš„åˆ›ä½œå†…å®¹ï¼ˆå°è¯´ç‰‡æ®µã€æƒ…èŠ‚æ„æ€ç­‰ï¼‰:")        elif choice == "2":            # æ–‡ä»¶è¾“å…¥            file_path = input(                "\nè¯·è¾“å…¥æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ï¼šE:/æˆ‘çš„å°è¯´/ç¬¬ä¸€ç« .txtï¼‰: ").strip()            user_input = read_text_file(file_path)            if not user_input:                print("ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥æ¨¡å¼")                user_input = multiline_input("\nè¯·è¾“å…¥æ‚¨çš„åˆ›ä½œå†…å®¹:")        else:            print("æ— æ•ˆé€‰æ‹©ï¼Œä½¿ç”¨æ‰‹åŠ¨è¾“å…¥æ¨¡å¼")            user_input = multiline_input("\nè¯·è¾“å…¥æ‚¨çš„åˆ›ä½œå†…å®¹:")        if not user_input:            print("âš ï¸ æœªè¾“å…¥ä»»ä½•å†…å®¹")            return            # æ·»åŠ åˆ°æ¶ˆæ¯å†å²            messages.append({"role": "user", "content": user_input})            # å‘é€è¯·æ±‚            response = send_to_deepseek(messages)            if response:                ai_reply = response["choices"][0]["message"]["content"]                # æ‰“å°å›å¤                print("\nğŸ¤– DeepSeek çš„å›å¤ï¼š")                print("-" * 80)                print(ai_reply)                print("-" * 80)                # è¯¢é—®æ˜¯å¦ä¿å­˜åˆ°æ–‡ä»¶                save_option = input("\næ˜¯å¦å°†å›å¤ä¿å­˜åˆ°æ–‡ä»¶ï¼Ÿ(y/n): ").lower()                if save_option == 'y':                    save_path = input(                        "è¯·è¾“å…¥ä¿å­˜è·¯å¾„ï¼ˆå¦‚ï¼šE:/AIå›å¤/ç¬¬ä¸€ç« åˆ†æ.txtï¼‰: ").strip()                    try:                        with open(save_path, 'w', encoding='utf-8') as file:                            file.write(ai_reply)                        print(f"âœ… å›å¤å·²ä¿å­˜åˆ°: {save_path}")                    except Exception as e:                        print(f"âš ï¸ ä¿å­˜æ–‡ä»¶æ—¶å‡ºé”™: {str(e)}")# 5. è„‘æ´é—²èŠdef chat_anything():    print("\n=== æŠ€æœ¯å°ç™¾ç§‘ ===")    print("è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ï¼ˆè¾“å…¥ 'é€€å‡º' ç»“æŸï¼‰")    messages = [{        "role": "system",        "content":            ""    }]    while True:        user_input = multiline_input("\næ‚¨: ")        if user_input.lower() in ["é€€å‡º", "exit"]:            break        # æ·»åŠ åˆ°æ¶ˆæ¯å†å²        messages.append({"role": "user", "content": user_input})        model = "deepseek-chat"        # å‘é€è¯·æ±‚        response = send_to_deepseek(messages, model=model)        if response:            ai_reply = response["choices"][0]["message"]["content"]            if ai_reply:                print(f"å·²æ”¶åˆ°å›å¤")            # æ·»åŠ åˆ°æ¶ˆæ¯å†å²            messages.append({"role": "assistant", "content": ai_reply})            # æ‰“å°å›å¤            print("\nğŸ¤– DeepSeek:")            print("-" * 50)            print(ai_reply)            print("-" * 50)# 6. ä¸»èœå•def main_menu():    while True:        print("\n===== DeepSeek åŠ©æ‰‹ =====")        print("1. æ­£ç»å†™æ–‡")        print("2. æŠ€æœ¯ç™¾ç§‘")        print("3. é€€å‡º")        choice = input("è¯·é€‰æ‹©åŠŸèƒ½: ")        if choice == "1":            literary_assistant()        elif choice == "2":            chat_anything()        elif choice == "3":            print("æ„Ÿè°¢ä½¿ç”¨ï¼Œå†è§ï¼")            break        else:            print("æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥")# 7. å¯åŠ¨ç¨‹åºif __name__ == "__main__":    """    novel_gui = AIChatGUI(        api_url=API_URL,        session_key=api_key  # æœåŠ¡å™¨å°†æ ¹æ®æ­¤keyç»´æŠ¤ç‹¬ç«‹è®°å¿†    )    novel_gui.run()    """    main_menu()